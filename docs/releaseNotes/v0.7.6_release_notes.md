# ‚ö†Ô∏è v0.7.6

This release forms another incremental step towards a complete refactor, storing all data using [JsonDbApp](https://github.com/h-arnold/JsonDbApp). All data is now _stored_ in JsonDbApp, including Assignment Definitions which have been moved out of ScriptProperties.

This change will enable much more granular analysis of student work, with the ability to assign weightings to each task in each assignment, as well as to assignments as a whole. It doesn't currently _do anything_ with this data, but I wanted to push out this release so that the data is stored in readiness for future analysis in future releases.

## üö® Breaking change: Assignment Definitions now live in JsonDbApp

Assignment Definitions have moved out of ScriptProperties into JsonDbApp-backed collections to support richer metadata, dual-store hydration, and upcoming analytics. Before upgrading, clear your existing JsonDbApp state by deleting any database files and resetting `MASTER_INDEX` in the Script Properties editor. Assessment data continues to use the existing storage pipeline for now, but definition records will be re-created in JsonDbApp on first run after the upgrade.

## ‚ú® New features & improvements

- Assignment Definitions are decoupled from ScriptProperties, persisted in JsonDbApp, and enriched with metadata (including `yearGroup` and topic enrichment). Dual hydration supports both registry and full definition stores for safer migrations.
- Assignment and task models now handle partial definitions (including null task lists) and trimmed dehydrated payloads, reducing size while keeping hydration predictable; legacy alias handling was removed.
- Parsers propagate `documentId` across Slides and Sheets artefacts, improve formula preprocessing, and tighten ABLogger coverage for better diagnostics.
- UI gets a BeerCSS-powered playground and a dedicated BeerCSS UI handler, with GAS-friendly file ordering to avoid template reference errors and refreshed component styles.
- Developer experience: Vitest config now uses projects, dependency bumps (including @modelcontextprotocol/sdk), Java support in the dev container, and updated documentation for data shapes, hydration, and UI theming.

## üóÇ Files changed (high level)

Key files changed since v0.7.5 include (concise selection):

- [src/AdminSheet/Models/AssignmentDefinition.js](src/AdminSheet/Models/AssignmentDefinition.js) ‚Äî definition model revamped for JsonDbApp persistence, dual-store hydration, and richer metadata.
- [src/AdminSheet/y_controllers/AssignmentDefinitionController.js](src/AdminSheet/y_controllers/AssignmentDefinitionController.js) ‚Äî controls registry/full-store writes and hydration paths for definitions.
- [src/AdminSheet/AssignmentProcessor/Assignment.js](src/AdminSheet/AssignmentProcessor/Assignment.js) ‚Äî assignment model aligned to decoupled definitions and leaner dehydrated payloads.
- [src/AdminSheet/DocumentParsers/SlidesParser.js](src/AdminSheet/DocumentParsers/SlidesParser.js) and [src/AdminSheet/DocumentParsers/SheetsParser.js](src/AdminSheet/DocumentParsers/SheetsParser.js) ‚Äî propagate `documentId`, improve formula handling, and expand logging.
- [src/AdminSheet/UI/99_BeerCssUIHandler.js](src/AdminSheet/UI/99_BeerCssUIHandler.js) and [src/AdminSheet/UI/BeerCssPlayground.html](src/AdminSheet/UI/BeerCssPlayground.html) ‚Äî BeerCSS handler and playground dialog for previewing components.
- [src/AdminSheet/UI/97_globals.js](src/AdminSheet/UI/97_globals.js) and [src/AdminSheet/UI/98_UIManager.js](src/AdminSheet/UI/98_UIManager.js) ‚Äî reordered GAS UI entrypoints to match new BeerCSS flow and avoid load-order regressions.
- [tests/controllers/assignmentDefinitionController.fullStore.test.js](tests/controllers/assignmentDefinitionController.fullStore.test.js) and [tests/googleDriveManager/driveManager.definitionRefresh.test.js](tests/googleDriveManager/driveManager.definitionRefresh.test.js) ‚Äî expanded coverage for definition persistence, hydration, and Drive timestamp refresh.
- [docs/developer/UI.md](docs/developer/UI.md) and [docs/developer/DATA_SHAPES.md](docs/developer/DATA_SHAPES.md) ‚Äî refreshed guidance on BeerCSS usage, hydration levels, and updated data shapes.

## ‚¨ÜÔ∏è Updating to v0.7.6

1. In your Apps Script project, clear the JsonDbApp state: delete any existing database files and reset `MASTER_INDEX` in the Script Properties editor.
2. Open your Admin Sheet.
3. Click Assessment Bot -> Settings -> Update Version.
4. Select v0.7.6 and follow the prompts.

## ‚¨áÔ∏è Link to assets & downloads

Latest release assets for v0.7.6: https://drive.google.com/drive/u/0/folders/1xk7wQEX8jLKa0sKhBdkrSA7WJUucpPhv

## üßæ Changelog summary (technical)

- Breaking change: Assignment Definitions now persist to JsonDbApp with dual stores (registry + full definition) and richer metadata. ScriptProperties no longer holds definitions; migrate by clearing JsonDbApp state before upgrading.
- Improvement: Assignment/task models support partial definitions (including null tasks) and reduced dehydrated payloads while keeping full rehydration paths; legacy alias handling removed.
- Improvement: Parsers propagate `documentId` through artefacts, improve formula normalisation, and enhance ABLogger diagnostics for Slides; batch size and JsonDbApp lock defaults tuned for stability.
- Improvement: BeerCSS integration adds a BeerCSS UI handler, playground dialog, and reordered UI bundles for GAS-safe loading; templates refreshed for consistent styling.
- Improvement: Vitest projects restructure, dependency upgrades, dev container Java support, and documentation updates covering data shapes, hydration, and UI guidance.

If you have any questions or run into issues with this update, please raise them in the project issue tracker so the team can follow up promptly.
