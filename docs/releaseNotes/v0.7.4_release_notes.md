# ðŸ©¹ v0.7.4

## ðŸ”§ Patch fixes & small improvements

This is a small patch release that fixes an issue with how script authorisation is handled and aligns the Assessment Record template manifest with the Admin Sheet to avoid permissions problems for some users.

- Fix: make the script authorisation and trigger installation flow robust across users so first-run initialisation consistently prompts for and validates required scopes.
- Fix: ensure the Assessment Record template uses the same `appsscript.json` manifest (same `oauthScopes` and `enabledAdvancedServices`) as the Admin Sheet to prevent permission/authorization errors.
- Improvement: standardised logging around authorization and trigger creation (use `ABLogger`) to make diagnosis easier.

## ðŸ—‚ Files changed ( high level )

Key files changed on `main` since `v0.7.3` include (concise selection):

- `src/AdminSheet/Utils/TriggerController.js` â€” centralised trigger creation and enforcement of the required scopes via `ScriptApp.requireScopes`.
- `src/AdminSheet/Utils/ScriptAppManager.js` â€” encapsulates ScriptApp interactions and exposes helpers for checking and handling authorisation.
- `src/AdminSheet/y_controllers/InitController.js` â€” updated to use ScriptAppManager and TriggerController; improved first-run flow and menu creation logic.
- `src/AdminSheet/ConfigurationManager/*` â€” removal of legacy `scriptAuthorised` configuration and schema updates.
- `src/AssessmentRecordTemplate/appsscript.json` and `src/AdminSheet/appsscript.json` â€” manifest scope/service alignment.
- Tests updated/added: `tests/utils/scriptAppManager.test.js`, `tests/controllers/initController.test.js`, and other related tests.

## â¬†ï¸ Updating to v0.7.4

1. Open your existing Admin Sheet.
2. Click Assessment Bot -> Settings -> Update Version.
3. Select `v0.7.4` and follow the prompts.

Notes:

- No manual migration is required for most users. The release ensures the Assessment Record templates included with the project carry the same manifest scopes as the Admin Sheet.
- If you maintain copies of the Assessment Record template outside this project, ensure the template's `appsscript.json` has the same `oauthScopes` and `enabledAdvancedServices` entries as the Admin Sheet to avoid permission issues when users open the template.
- During first-run or first authorisation, users may be prompted to grant the required scopes â€” follow the on-screen flow to grant permissions.

## ðŸ“¦ Download

Get the updated files here: [INSERT DOWNLOAD LINK HERE]

## ðŸ§¾ Changelog summary (technical)

- Refactor: Centralised trigger and authorization handling using `TriggerController` and `ScriptApp.requireScopes`.
- Fix: Removed `scriptAuthorised` flag and replaced checks with `ScriptAppManager` helpers (`isAuthorised`, `handleAuthFlow`, `revokeAuthorisation`).
- Fix: Assessment Record template manifest (`appsscript.json`) updated to match Admin Sheet (scopes & enabled advanced services).
- Improvement: Replaced `console.*` logging with `ABLogger` in several modules; added/updated tests for authorization flows.
