# ðŸ©¹ v0.7.5

## ðŸ”§ Patch fixes & small improvements

This small patch release fixes a regression in the caching pipeline which was preventing assessments from being cached, corrects the script initialisation and authorisation flow (so authorising the Admin Sheet no longer falsely marks other users as authorised), and adds the first pass of assignment serialisation to JsonDbApp.

- Fix: restore caching flow so successful assessments are cached and cache hits correctly prevent duplicate requests.
- Fix: script initialisation & authorisation flow updated to ensure per-user verification and to prevent an administrative authorisation from masking unauthorised users.
- Improvement: initial implementation of the assignment persistence flow to write full assignment serialised JSON to `JsonDbApp` (collection naming convention: `assign_full_<courseId>_<assignmentId>`). This work is incomplete but prevents data loss and sets the foundation for full persistence.
- Improvement: stability and logging improvements across request handling and initialisation code (ABLogger usage and clearer debug messages).

## ðŸ—‚ Files changed (high level)

Key files changed since `v0.7.4` include (concise selection):

- `src/AdminSheet/RequestHandlers/LLMRequestManager.js` â€” fixed the request generation and caching logic; ensured the cache is used and updated consistently.
- `src/AdminSheet/RequestHandlers/CacheManager.js` â€” stable cache key generation and a clearer cache put/get/serialize pipeline.
- `src/AdminSheet/y_controllers/InitController.js` â€” improved per-user initialisation & script authorisation checks; ensure the Admin Sheet and Assessment Record flows are distinct.
- `src/AdminSheet/Utils/ScriptAppManager.js` â€” encapsulated ScriptApp interactions and the per-user authorisation helpers used by `InitController`.
- `src/AdminSheet/DbManager/DbManager.js` â€” JsonDbApp wrapper and helpers for persisting assignment records.
- `src/AdminSheet/y_controllers/ABClassController.js` â€” added `persistAssignmentRun()` to write full JSON to `assign_full_...` collections and update partial records in the ABClass instance.
- `src/AssessmentRecordTemplate/menus/init.js` â€” fixed the template initialisation call to the correct library entrypoint and ensured menu creation is handled in the template context (per-user).
- `src/AdminSheet/zz_main.js` â€” added public helpers used by the assessment record template to check authorisation, create menus and revoke auth.
- `tests/requestHandlers/assignmentPhase3.test.js` and related tests â€” updated/added tests to verify caching behaviour, successful caching after retries, and the request generation paths.

## â¬†ï¸ Updating to v0.7.5

1. Open your existing Admin Sheet.
2. Click `Assessment Bot -> Settings -> Update Version`.
3. Select `v0.7.5` and follow the prompts.

## â¬‡ï¸ Link to assets & downloads

Latest release assets for v0.7.5: https://drive.google.com/drive/u/0/folders/1OCwes-UKQP-lJh3SEqdRsJzg9rcZUFv8

## â¬†ï¸ Updating to v0.7.5

1. Open your existing Admin Sheet.
2. Click Assessment Bot -> Settings -> Update Version.
3. Select `v0.7.5` and follow the prompts.

## ðŸ§¾ Changelog summary (technical)

- Fix: LLMRequestManager now constructs request payloads correctly and uses `CacheManager.getCachedAssessment(...)` to check for cached results based on the content-hash pair; cache keys are now deterministic and well formed.
- Fix: Request handlers now consistently call `CacheManager.setCachedAssessment(...)` using the `uidIndex` mapping to ensure they persist cache entries after successful and retry successes.
- Fix: Assessment record template initialisation now calls the library initialisation functions correctly (`AssessmentBot.handleScriptInit()` / `handleAssessmentRecordAuth`), and template menus are created in the template context only (per-user), avoiding an admin authorisation leaking across users.
- Improvement: `ABClassController.persistAssignmentRun()` writes a complete assignment snapshot (via `assignment.toJSON()`) into a JsonDbApp collection named `assign_full_<courseId>_<assignmentId>` and updates the ABClass's partial assignment summary. This is a first pass and further work will follow in subsequent releases.
- Improvement: Added/updated unit tests for request handling and caching, plus test coverage for partial & full assignment serialisation paths.

If you have any questions or run into issues with this update, please raise them in the project issue tracker so the team can follow up promptly.
