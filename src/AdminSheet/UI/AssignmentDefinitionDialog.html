<!DOCTYPE html>
<html lang="en">
  <head>
    <?!= include('UI/partials/Head') ?>
    <?!= include('UI/vendor/beercss/BeerCssScoped') ?>
    <title>Manage Assignment Definition</title>
    <style>
      html, body { margin: 0; padding: 0; }
      .beer { padding: 1rem; display: flex; flex-direction: column; gap: 1rem; }
      .identity-card { position: sticky; top: 0; z-index: 10; }
      .section-card { margin-bottom: 1rem; }
      .task-card { margin-left: 1rem; border-left: 2px solid var(--primary); padding-left: 1rem; }
      .chip-container { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; }
      footer.actions { display: flex; justify-content: flex-end; gap: 0.75rem; margin-top: 1rem; }
    </style>
  </head>
  <body>
    <div class="beer">
      <!-- Pinned Identity Section -->
      <header class="identity-card surface-card border">
        <div class="row">
          <div class="max">
            <h6 class="primary-text">Assignment Identity</h6>
            <div class="row small-space">
              <div class="field label fill max">
                <input type="text" value="<?= definition.primaryTitle || '' ?>" readonly>
                <label>Primary Title</label>
              </div>
              <div class="field label fill max">
                <input type="text" value="<?= definition.primaryTopic || '' ?>" readonly>
                <label>Primary Topic</label>
              </div>
              <div class="field label fill" style="width: 100px;">
                <input type="number" value="<?= definition.yearGroup || '' ?>" readonly>
                <label>Year</label>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main>
        <!-- Documents Accordion -->
        <details class="accordion border section-card">
          <summary class="none">
            <div class="row">
              <i class="primary-text">description</i>
              <div class="max">
                <h6 class="small">Documents & Weighting</h6>
              </div>
              <i>expand_more</i>
            </div>
          </summary>
          <div class="padding">
            <div class="field label fill">
              <select>
                <option <?= definition.documentType === 'SLIDES' ? 'selected' : '' ?>>SLIDES</option>
                <option <?= definition.documentType === 'SHEETS' ? 'selected' : '' ?>>SHEETS</option>
              </select>
              <label>Document Type</label>
            </div>
            <div class="field label fill">
              <input type="text" value="<?= definition.referenceDocumentId || '' ?>">
              <label>Reference Document ID</label>
            </div>
            <div class="field label fill">
              <input type="text" value="<?= definition.templateDocumentId || '' ?>">
              <label>Template Document ID</label>
            </div>
            <div class="field label fill">
              <input type="number" value="<?= definition.assignmentWeighting || '' ?>">
              <label>Assignment Weighting</label>
            </div>
          </div>
        </details>

        <!-- Aliases Accordion -->
        <details class="accordion border section-card">
          <summary class="none">
            <div class="row">
              <i class="primary-text">label</i>
              <div class="max">
                <h6 class="small">Aliases (Titles & Topics)</h6>
              </div>
              <i>expand_more</i>
            </div>
          </summary>
          <div class="padding">
            <p class="small-text">Add alternative titles or topics that might be used for this assignment.</p>
            
            <div class="row small-space">
              <div class="field label fill max">
                <input type="text" placeholder="e.g. Lesson 1: Intro">
                <label>New Alternate Title</label>
              </div>
              <button class="button primary">Add</button>
            </div>
            <div class="chip-container">
              <? (definition.alternateTitles || []).forEach(title => { ?>
                <div class="chip border">
                  <span><?= title ?></span>
                  <i>close</i>
                </div>
              <? }) ?>
              <span class="chip border grey-text italic">Example Title Chip</span>
            </div>

            <div class="row small-space mt-3">
              <div class="field label fill max">
                <input type="text" placeholder="e.g. Computing Basics">
                <label>New Alternate Topic</label>
              </div>
              <button class="button primary">Add</button>
            </div>
            <div class="chip-container">
              <? (definition.alternateTopics || []).forEach(topic => { ?>
                <div class="chip border">
                  <span><?= topic ?></span>
                  <i>close</i>
                </div>
              <? }) ?>
              <span class="chip border grey-text italic">Example Topic Chip</span>
            </div>
          </div>
        </details>

        <!-- Tasks Accordion -->
        <details class="accordion border section-card">
          <summary class="none">
            <div class="row">
              <i class="primary-text">assignment</i>
              <div class="max">
                <h6 class="small">Task Definitions</h6>
              </div>
              <i>expand_more</i>
            </div>
          </summary>
          <div class="padding">
            <div class="row">
              <div class="max">
                <p class="small-text">Configure individual tasks and their assessment criteria.</p>
              </div>
              <button class="button border small">
                <i>add</i>
                <span>Add Task</span>
              </button>
            </div>

            <!-- Nested Task Accordions -->
            <div class="vertical small-space mt-3">
              <? if (definition.tasks) { ?>
                <? Object.entries(definition.tasks).forEach(([taskId, task]) => { ?>
                  <details class="accordion border task-card">
                    <summary class="none">
                      <div class="row">
                        <div class="max">
                          <span class="bold"><?= task.taskTitle || taskId ?></span>
                        </div>
                        <i>expand_more</i>
                      </div>
                    </summary>
                    <div class="padding">
                      <div class="field label fill">
                        <input type="text" value="<?= task.taskTitle || '' ?>">
                        <label>Task Title</label>
                      </div>
                      <!-- Placeholder for more task fields -->
                      <p class="italic small-text">Task-specific criteria and settings will go here.</p>
                    </div>
                  </details>
                <? }) ?>
              <? } else { ?>
                <div class="center-align padding">
                  <p class="grey-text">No tasks defined yet.</p>
                </div>
              <? } ?>
            </div>
          </div>
        </details>
      </main>

      <footer class="actions">
        <button class="button border" onclick="google.script.host.close()">Cancel</button>
        <button class="button primary">Save Definition</button>
      </footer>
    </div>
  </body>
</html>
