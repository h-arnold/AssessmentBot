<!-- ClassroomDropdown.html -->
<!DOCTYPE html>
<html>
<head>
    <base target="_top">
    <!-- Material Web CSS for styling -->
    <link href="../ui/assets/material-web.css" rel="stylesheet">
    <style>
        .modal-content {
            padding: 20px;
        }
        .modal-footer {
            padding: 10px;
            text-align: right;
        }
        .modal-footer md-filled-button,
        .modal-footer md-outlined-button {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class="modal-content">
        <h5>Select Your Classroom</h5>
        <div class="input-field">
            <md-outlined-select id="classrooms" name="classrooms" label="Classroom">
                <md-select-option value="" disabled selected>
                    <div slot="headline">Choose your classroom</div>
                </md-select-option>
                <? for (let i = 0; i < classrooms.length; i++) { ?>
                    <md-select-option value="<?= classrooms[i].id ?>">
                        <div slot="headline"><?= classrooms[i].name ?></div>
                    </md-select-option>
                <? } ?>
            </md-outlined-select>
        </div>
    </div>
    <div class="modal-footer">
        <md-outlined-button onclick="google.script.host.close()">Cancel</md-outlined-button>
        <md-filled-button onclick="saveClassroom()">Save</md-filled-button>
    </div>

    <!-- Material Web JavaScript -->
    <script src="../ui/assets/material-web.js"></script>
    <script>
        // Simple toast notification function
        function showToast(message, type = 'info') {
          const toast = document.createElement('div');
          toast.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 4px;
            color: white;
            z-index: 10000;
            background-color: ${type === 'error' ? '#f44336' : type === 'success' ? '#4caf50' : '#2196f3'};
          `;
          toast.textContent = message;
          document.body.appendChild(toast);
          
          setTimeout(() => {
            toast.remove();
          }, 3000);
        }

        /**
         * Saves the selected classroom to the spreadsheet.
         */
        function saveClassroom() {
            const select = document.getElementById('classrooms');
            const courseId = select.value;
            const selectedOption = select.querySelector(`md-select-option[value="${courseId}"]`);
            const courseName = selectedOption ? selectedOption.querySelector('[slot="headline"]').textContent : '';

            if (!courseId || !courseName) {
                alert('Please select a classroom.');
                return;
            }

            // Call server-side function to save the selected classroom
            google.script.run
                .withSuccessHandler(function() {
                    // Display a toast message
                    showToast('Classroom saved successfully.', 'success');

                    // Close the modal dialog
                    google.script.host.close();
                })
                .withFailureHandler(function(error) {
                    alert('Error: ' + error.message);
                })
                .saveClassroom(courseName, courseId);
        }
    </script>
</body>
</html>
